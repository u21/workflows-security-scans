name: Security-Scans

on: 
  workflow_call:
    secrets:
      GITGUARDIAN:
        required: false
      VERACODE_API_ID:
        required: false
      VERACODE_API_KEY:
        required: false
        
env :
  GITGUARDIAN_API_KEY: ${{ secrets.GITGUARDIAN }}
  VERACODE_API_ID: ${{ secrets.VERACODE_API_ID }}
  VERACODE_API_KEY: ${{ secrets.VERACODE_API_KEY }}

jobs :
  veracode :
    runs-on : ubuntu-latest
    steps :
      - name: Checkout workflows-security-scans
        uses: actions/checkout@v2
        with:
          repository: u21/workflows-security-scans
          path: workflows-security-scans
      
      - name : checkout
        uses : actions/checkout@v2

      - name : check file
        run: ls
      
      - name : check 2
        run : cd workflows-security-scans && ls
      
      - name : zip repo
        run : zip -r code.zip .

      - name : run veracode
        run : java -jar workflows-security-scans/pipeline-scan.jar -vid ${{ secrets.VERACODE_API_ID }} -vkey ${{ secrets.VERACODE_API_KEY }} -jd true -jo true --file code.zip

      - name : export findings
        if: ${{ failure() }}
        uses: actions/upload-artifact@v2
        with:
          name: Veracode_Results
          path: results.json